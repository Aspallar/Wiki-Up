<local:BasePage x:TypeArguments="local:UploadViewModel" x:Class="WikiUpload.UploadPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
      xmlns:local="clr-namespace:WikiUpload"
      mc:Ignorable="d" 
      d:DesignHeight="480" d:DesignWidth="800"
      Title="Upload">

    <Page.Resources>
        <Style x:Key="UploadFilesListBox">
            <Style.Resources>
                <!-- Background of selected item when focussed -->
                <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}"
                                 Color="{StaticResource ButtonColor}" />
            </Style.Resources>
        </Style>
    </Page.Resources>

    <Border Background="{StaticResource BackGroundColorBrush}">

        <Grid MinWidth="586" MinHeight="480">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <TabControl Padding="0" Grid.Column="0" x:Name="tabControl">
                <TabItem Header="Upload" FontFamily="{StaticResource MainFont}" FontSize="{StaticResource FontSizeRegular}">
                    <Grid Background="{StaticResource BackGroundColorBrush}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="6*"/>
                            <ColumnDefinition Width="4*" MaxWidth="400"/>
                        </Grid.ColumnDefinitions>
                        <ListBox x:Name="FilesListBox" Background="{StaticResource ControlBackgroundBrush}"  Margin="10"
                                 AllowDrop="True"
                                 SelectionMode="Extended"
                                 ItemsSource="{Binding UploadFiles}"
                                 local:IsDropFileEnabledProperty.Value="True"
                                 local:DropFileTargetProperty.Value="{Binding}"
                                 local:ViewedItemProperty.Value="{Binding ViewedFile}"
                                 Style="{StaticResource UploadFilesListBox}">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="0 0 0 5">
                                        <Grid>
                                            <iconPacks:PackIconFontAwesome Kind="CircleSolid"
                                                   Style="{StaticResource FontSizeIcon}"
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Center"
                                                   FontSize="{StaticResource FontSizeLarge}"
                                                   Foreground="{Binding Status, Converter={local:UploadFileStatusToColorConverter}}"/>
                                            <iconPacks:PackIconFontAwesome Kind="SpinnerSolid"
                                                   Style="{StaticResource SpinningIcon}"
                                                   FontSize="{StaticResource FontSizeRegular}"
                                                   Foreground="{StaticResource ForegroundLightBrush}"
                                                   Visibility="{Binding Status, Converter={local:UploadFileStatusToVisiblityConverter}}"
                                                   VerticalAlignment="Center"
                                                   HorizontalAlignment="Center"/>
                                        </Grid>
                                        <StackPanel Margin="5 0 0 0">
                                            <Button Style="{StaticResource FilenameTextButton}"
                                                Content="{Binding FileName}"
                                                Command="{Binding DataContext.ShowFileCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=Page, AncestorLevel=1}}"
                                                CommandParameter="{Binding FullPath}"/>
                                            <TextBlock FontSize="{StaticResource FontSizeSmall}" Text="{Binding Folder}"/>
                                            <TextBlock FontSize="{StaticResource FontSizeSmall}" FontStyle="Italic" Text="{Binding Message}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                            <ListBox.InputBindings>
                                <KeyBinding 
                                    Key="Delete" 
                                    Command="{Binding RemoveFilesCommand}"
                                    CommandParameter="{Binding ElementName=FilesListBox, Path=SelectedItems}"/>
                            </ListBox.InputBindings>
                        </ListBox>
                        <StackPanel Grid.Column="2" Margin="10">
                            <Button Content="Add Files" Margin="0"
                                ToolTip="Add files to the upload list"
                                Command="{Binding AddFilesCommand}"
                                IsEnabled="{Binding UploadIsRunning, Converter={local:NotConverter}}"/>
                            <Button Content="Remove Files" 
                                ToolTip="Remove selected files from the upload list"
                                Command="{Binding RemoveFilesCommand}"
                                CommandParameter="{Binding ElementName=FilesListBox, Path=SelectedItems}"
                                IsEnabled="{Binding UploadIsRunning, Converter={local:NotConverter}}"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                </Grid.ColumnDefinitions>
                                <Button Content="Load" Grid.Column="0" Margin="0 0 5 0"
                                    ToolTip="Add files from a previously saved upload list."
                                    Command="{Binding LoadListCommand}"
                                    IsEnabled="{Binding UploadIsRunning, Converter={local:NotConverter}}"/>
                                <Button Content="Save" Grid.Column="1" Margin="5 0 0 0"
                                    ToolTip="Save the upload list."
                                    Command="{Binding SaveListCommand}"
                                    IsEnabled="{Binding UploadIsRunning, Converter={local:NotConverter}}"/>
                            </Grid>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0 5 0 0">
                                <TextBlock Text="{Binding UploadFiles.Count}" FontFamily="{StaticResource MainFont}" FontSize="{StaticResource FontSizeRegular}"/>
                                <TextBlock Text=" Files" FontFamily="{StaticResource MainFont}" FontSize="{StaticResource FontSizeRegular}"/>
                            </StackPanel>
                        </StackPanel>
                        <StackPanel Margin="10" Grid.Column="2" VerticalAlignment="Bottom">
                            <CheckBox Content="Force Upload"
                                  IsEnabled="{Binding UploadIsRunning, Converter={local:NotConverter}}"
                                  IsChecked="{Binding ForceUpload, Mode=OneWayToSource}">
                                <CheckBox.LayoutTransform>
                                    <ScaleTransform ScaleX="1.4" ScaleY="1.4" />
                                </CheckBox.LayoutTransform>
                            </CheckBox>

                            <TextBlock FontFamily="{StaticResource MainFont}"
                                   FontSize="{StaticResource FontSizeSmall}"
                                   TextWrapping="Wrap" Margin="0 0 0 20">
                                Tick to ignore warnings and force the upload even if the file already exists or is a duplicate.
                            </TextBlock>
                            <Button  Content="Cancel"
                                     IsEnabled="{Binding UploadIsRunning}"
                                     Command="{Binding CancelCommand}"
                                     ToolTip="Cancel running upload."/>
                            <Button Content="Upload"
                                    Command="{Binding UploadCommand}"
                                    local:IsBusyProperty.Value="{Binding UploadIsRunning}"
                                    ToolTip="Start uploading files."/>
                        </StackPanel>
                    </Grid>
                </TabItem>

                <TabItem Header="Content" FontFamily="{StaticResource MainFont}" FontSize="{StaticResource FontSizeRegular}">
                    <Border Background="{StaticResource BackGroundColorBrush}" Padding="30 10 30 10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            <StackPanel Grid.Row="0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock FontFamily="{StaticResource MainFont}"
                                       FontSize="{StaticResource FontSizeRegular}"
                                       Text="Summary"/>
                                    <TextBlock Margin="5 0 0 0" VerticalAlignment="Bottom" FontSize="{StaticResource FontSizeSmall}">
                                        This is the summary for the upload in the wiki's activity log.
                                    </TextBlock>
                                </StackPanel>
                                <TextBox Text="{Binding UploadSummary}"
                                     FontSize="{StaticResource FontSizeRegular}"
                                     Background="{StaticResource ControlBackgroundBrush}"/>
                                <TextBlock FontFamily="{StaticResource MainFont}"
                                       FontSize="{StaticResource FontSizeRegular}"
                                       Text="Content"
                                       Margin="0 10 0 0"/>
                                <TextBlock FontSize="{StaticResource FontSizeSmall}" TextWrapping="Wrap" Margin="0 0 0 3">
                                    Enter the wikitext to use as the initial page content for new images below.
                                    This will be used only for new images, it will not replace any existing
                                    page content. Note: use [[Category:My Category]] to add categories.
                                </TextBlock>
                            </StackPanel>
                            <Grid Grid.Row="1">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="5*"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <TextBox
                                 VerticalAlignment="Stretch"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 FontSize="{StaticResource FontSizeRegular}"
                                 Background="{StaticResource ControlBackgroundBrush}"
                                 Text="{Binding PageContent}"/>

                                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" MaxHeight="60">
                                    <Button Content="Save" Margin="0 10 10 10"
                                        Command="{Binding SaveContentCommand}"
                                        ToolTip="Save content to file."/>
                                    <Button Content="Load" Margin="0 10 0 10"
                                        Command="{Binding LoadContentCommand}"
                                        ToolTip="Load content from file."/>

                                </StackPanel>
                            </Grid>
                        </Grid>
                    </Border>
                </TabItem>
            </TabControl>

            <Grid Grid.Row="0" VerticalAlignment="Top" Margin="0,2,0,0">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" 
                VerticalAlignment="Center" >
                    <Button VerticalAlignment="Center" Margin="0 5 16 0"
                            Style="{StaticResource TextButton}"
                            Content="{Binding Site}"
                            Command="{Binding LaunchSiteCommand}"/>
                </StackPanel>
            </Grid>

        </Grid>

    </Border>
</local:BasePage>
